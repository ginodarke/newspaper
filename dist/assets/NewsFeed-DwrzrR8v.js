import{r,j as e,u as T,a as I,L as E}from"./index-CrJ8FlQI.js";import{g as z,a as U}from"./news-BjdQ78CF.js";import{M as $,u as L,P as W,a as B,b as D,L as F,S as H,m as R,A as Y}from"./SearchBar-DJ0Qu-6J.js";import{T as G}from"./ThemeToggle-Huioqr6Y.js";class K extends r.Component{getSnapshotBeforeUpdate(i){const s=this.props.childRef.current;if(s&&i.isPresent&&!this.props.isPresent){const n=this.props.sizeRef.current;n.height=s.offsetHeight||0,n.width=s.offsetWidth||0,n.top=s.offsetTop,n.left=s.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function V({children:a,isPresent:i}){const s=r.useId(),n=r.useRef(null),x=r.useRef({width:0,height:0,top:0,left:0}),{nonce:f}=r.useContext($);return r.useInsertionEffect(()=>{const{width:u,height:l,top:p,left:c}=x.current;if(i||!n.current||!u||!l)return;n.current.dataset.motionPopId=s;const d=document.createElement("style");return f&&(d.nonce=f),document.head.appendChild(d),d.sheet&&d.sheet.insertRule(`
          [data-motion-pop-id="${s}"] {
            position: absolute !important;
            width: ${u}px !important;
            height: ${l}px !important;
            top: ${p}px !important;
            left: ${c}px !important;
          }
        `),()=>{document.head.removeChild(d)}},[i]),e.jsx(K,{isPresent:i,childRef:n,sizeRef:x,children:r.cloneElement(a,{ref:n})})}const q=({children:a,initial:i,isPresent:s,onExitComplete:n,custom:x,presenceAffectsLayout:f,mode:u})=>{const l=L(O),p=r.useId(),c=r.useCallback(m=>{l.set(m,!0);for(const g of l.values())if(!g)return;n&&n()},[l,n]),d=r.useMemo(()=>({id:p,initial:i,isPresent:s,custom:x,onExitComplete:c,register:m=>(l.set(m,!1),()=>l.delete(m))}),f?[Math.random(),c]:[s,c]);return r.useMemo(()=>{l.forEach((m,g)=>l.set(g,!1))},[s]),r.useEffect(()=>{!s&&!l.size&&n&&n()},[s]),u==="popLayout"&&(a=e.jsx(V,{isPresent:s,children:a})),e.jsx(W.Provider,{value:d,children:a})};function O(){return new Map}const C=a=>a.key||"";function S(a){const i=[];return r.Children.forEach(a,s=>{r.isValidElement(s)&&i.push(s)}),i}const _=({children:a,custom:i,initial:s=!0,onExitComplete:n,presenceAffectsLayout:x=!0,mode:f="sync",propagate:u=!1})=>{const[l,p]=B(u),c=r.useMemo(()=>S(a),[a]),d=u&&!l?[]:c.map(C),m=r.useRef(!0),g=r.useRef(c),y=L(()=>new Map),[b,A]=r.useState(c),[v,w]=r.useState(c);D(()=>{m.current=!1,g.current=c;for(let o=0;o<v.length;o++){const h=C(v[o]);d.includes(h)?y.delete(h):y.get(h)!==!0&&y.set(h,!1)}},[v,d.length,d.join("-")]);const k=[];if(c!==b){let o=[...c];for(let h=0;h<v.length;h++){const j=v[h],N=C(j);d.includes(N)||(o.splice(h,0,j),k.push(j))}f==="wait"&&k.length&&(o=k),w(S(o)),A(c);return}const{forceRender:t}=r.useContext(F);return e.jsx(e.Fragment,{children:v.map(o=>{const h=C(o),j=u&&!l?!1:c===v||d.includes(h),N=()=>{if(y.has(h))y.set(h,!0);else return;let P=!0;y.forEach(M=>{M||(P=!1)}),P&&(t==null||t(),w(g.current),u&&(p==null||p()),n&&n())};return e.jsx(q,{isPresent:j,initial:!m.current||s?void 0:!1,custom:j?void 0:i,presenceAffectsLayout:x,mode:f,onExitComplete:j?void 0:N,children:o},h)})})},J=async(a,i)=>{await new Promise(n=>setTimeout(n,800));const s=["This aligns with your interest in technology and innovation.","Based on your location, this news could impact local services.","You've previously shown interest in content like this.","This topic connects to your professional field.","This news is trending significantly in your area."];return s[Math.floor(Math.random()*s.length)]},Q=async(a,i)=>{try{const s=await J(a,i);return{...a,relevanceReason:s}}catch(s){return console.error("Error enriching article with AI:",s),a}};function se(){const a=T(),{user:i}=I(),[s,n]=r.useState("For You"),[x,f]=r.useState(null),[u,l]=r.useState([]),[p,c]=r.useState(!0),[d,m]=r.useState(null),[g,y]=r.useState(null),[b,A]=r.useState(null),v=["For You","Trending","Local","International","National"];r.useEffect(()=>{(async()=>{if(i)try{const{preferences:o}=await z(i.id);A(o)}catch(o){console.error("Error fetching user preferences:",o)}})()},[i]),r.useEffect(()=>{(async()=>{c(!0),m(null);try{const o=await U(b||void 0);if(i&&b){const h=o.map(N=>Q(N,b)),j=await Promise.all(h);l(j)}else l(o)}catch(o){console.error("Error fetching articles:",o),m("Failed to load articles. Please try again later.")}finally{c(!1)}})()},[i,s,b]);const w=t=>{y(t)},k=t=>{a(`/search?q=${encodeURIComponent(t)}`)};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 transition-colors duration-200",children:[e.jsx("header",{className:"bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 sticky top-0 z-10 transition-colors duration-200",children:e.jsxs("div",{className:"container mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-primary dark:text-white",children:"Newspaper.AI"}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(G,{}),i?e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Welcome back"}),e.jsx(E,{to:"/profile",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:"Go to Profile",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})})]}):e.jsx(E,{to:"/auth",className:"p-2 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",className:"w-6 h-6",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M11 16l-4-4m0 0l4-4m-4 4h14m-5 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h7a3 3 0 013 3v1"})})})]})]}),e.jsx("div",{className:"mt-4 mb-4",children:e.jsx(H,{onSearch:k})}),e.jsx("div",{className:"flex overflow-x-auto space-x-4 pb-2",children:v.map(t=>e.jsx("button",{onClick:()=>n(t),className:`px-4 py-2 rounded-md whitespace-nowrap transition-colors ${s===t?"bg-primary text-white":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600"}`,children:t},t))})]})}),e.jsx("main",{className:"container mx-auto px-4 py-6",children:p?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12",children:[e.jsx("div",{className:"w-12 h-12 border-t-2 border-primary border-solid rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Loading articles..."})]}):d?e.jsxs("div",{className:"p-6 bg-red-50 dark:bg-red-900/30 text-red-500 dark:text-red-300 rounded-lg text-center",children:[e.jsx("p",{children:d}),e.jsx("button",{onClick:()=>n(s),className:"mt-4 px-4 py-2 bg-primary text-white rounded-md",children:"Try Again"})]}):u.length===0?e.jsx("div",{className:"p-6 bg-gray-50 dark:bg-gray-800 text-gray-500 dark:text-gray-400 rounded-lg text-center",children:e.jsx("p",{children:"No articles found for this category."})}):e.jsx("div",{className:"space-y-6",children:u.map(t=>e.jsxs(R.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-md overflow-hidden transition-colors duration-200",children:[e.jsx("div",{className:"cursor-pointer",onClick:()=>w(t),children:t.imageUrl&&e.jsx("img",{src:t.imageUrl,alt:t.title,className:"w-full h-48 object-cover"})}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"cursor-pointer",onClick:()=>w(t),children:[e.jsx("h2",{className:"text-xl font-bold hover:text-primary dark:hover:text-primary-400",children:t.title}),e.jsxs("div",{className:"flex items-center mt-1 text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:t.source}),e.jsx("span",{className:"mx-2",children:"â€¢"}),e.jsx("span",{children:new Date(t.publishedAt).toLocaleDateString()})]})]}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium bg-gray-100 dark:bg-gray-700 rounded-md",children:t.category})]}),e.jsx("p",{className:"mt-3 text-gray-700 dark:text-gray-300",children:t.summary}),t.relevanceReason&&e.jsxs("div",{className:"mt-4 p-3 bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 rounded-md text-sm",children:[e.jsx("strong",{children:"Why this matters to you:"})," ",t.relevanceReason]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>f(x===t.id?null:t.id),className:"text-primary dark:text-blue-400 text-sm font-medium hover:underline",children:x===t.id?"Hide context":"Show context"}),e.jsx("button",{onClick:()=>w(t),className:"text-primary dark:text-blue-400 text-sm font-medium hover:underline",children:"Read full article"})]}),x===t.id&&e.jsxs(R.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mt-4 p-4 bg-gray-50 dark:bg-gray-700 rounded-md",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Additional Context"}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:t.content||"This topic has been developing over the last few months. Similar events occurred in 2019 and 2021. Experts suggest this could have significant implications for future developments in this field."})]})]})]},t.id))})}),e.jsx(_,{children:g&&e.jsx(Y,{article:g,onClose:()=>y(null)})})]})}export{se as default};
