import{j as r}from"./ui--n0l2wTA.js";import{r as t,u as L,i as F}from"./vendor-BvJ-yVPi.js";import{A as T}from"./ArticleCard-ClAHm5AA.js";import{A as z}from"./ArticleDetail-B0JlTM1-.js";import{a as B,L as U}from"./index-DD25s8zy.js";import{g as M,a as _}from"./news-GvrH7eKe.js";import{b as q}from"./location-RXTUKDXl.js";import{R as G,j as H}from"./icons-Bqiqei89.js";import"./utils-U3DZdfOV.js";import"./animation-C8ivTUSO.js";import"./three-TYGphhMp.js";function te(){const[u,N]=t.useState([]),[h,l]=t.useState(!0),[n,i]=t.useState(null),[b,S]=t.useState(1),[g,w]=t.useState(1),[d,m]=t.useState(null),[f,x]=t.useState(!1),C=9,{user:a}=B(),p=L(),{id:c,category:o}=F();t.useEffect(()=>{y()},[o]),t.useEffect(()=>{c&&P(c)},[c]);const P=async e=>{try{l(!0);const s=await M(e);s?m(s):(i(`Article with ID ${e} not found`),p("/404"))}catch(s){i("Error loading article"),console.error("Error loading article:",s)}finally{l(!1)}},y=async()=>{try{l(!0),i(null);let e;try{e=await q()}catch(I){console.warn("Could not get user location:",I)}const s={category:o||void 0,location:e,userPreferences:a!=null&&a.preferences?{categories:a.preferences.categories||[],sources:a.preferences.sources||[],interests:a.preferences.interests||[],location:a.preferences.location||""}:void 0},{articles:A,totalResults:D}=await _(s);A.length===0?i("No articles found. Try a different category or refresh."):(N(A),w(Math.ceil(D/C)))}catch(e){i("Failed to load articles. Please try again later."),console.error("Error loading articles:",e)}finally{l(!1),x(!1)}},E=()=>{x(!0),y()},R=e=>{S(e),window.scrollTo({top:0,behavior:"smooth"})},k=e=>{m(e),window.history.pushState({},"",`/article/${e.id}`)},$=()=>{m(null),c&&p("/categories/"+(o||""))},j=e=>{console.log("Saving article:",e)},v=e=>{console.log("Sharing article:",e)};return h&&!f?r.jsx("div",{className:"flex justify-center items-center h-[50vh]",children:r.jsx(U,{})}):d?r.jsx("div",{className:"container mx-auto px-4 py-8",children:r.jsx(z,{article:d,onClose:$,onSave:j,onShare:()=>v(d.id)})}):r.jsxs("div",{className:"container mx-auto px-4 py-8",children:[r.jsxs("div",{className:"flex justify-between items-center mb-8",children:[r.jsx("h1",{className:"text-3xl font-bold",children:o?`${o.charAt(0).toUpperCase()+o.slice(1)} News`:"News Feed"}),r.jsx("button",{onClick:E,className:`p-2 rounded-full bg-primary/10 text-primary hover:bg-primary/20 transition-colors ${f?"animate-spin":""}`,disabled:f,"aria-label":"Refresh",children:r.jsx(G,{size:20})})]}),n&&r.jsxs("div",{className:"mb-8 p-4 bg-red-50 border border-red-200 rounded-lg flex items-center text-red-700",children:[r.jsx(H,{size:20,className:"mr-2 flex-shrink-0"}),r.jsx("p",{children:n})]}),u.length>0?r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:u.map(e=>r.jsx(T,{article:e,onClick:()=>k(e),onSave:()=>j(e.id),onShare:()=>v(e.id)},e.id))}):!n&&!h?r.jsx("div",{className:"text-center py-12",children:r.jsx("p",{className:"text-lg text-muted-foreground",children:"No articles to display."})}):null,g>1&&r.jsx("div",{className:"mt-8 flex justify-center",children:r.jsx("nav",{className:"flex items-center space-x-2",children:Array.from({length:g},(e,s)=>s+1).map(e=>r.jsx("button",{onClick:()=>R(e),className:`w-10 h-10 flex items-center justify-center rounded-md ${b===e?"bg-primary text-primary-foreground":"bg-card text-muted-foreground hover:bg-primary/10"}`,children:e},e))})})]})}export{te as default};
