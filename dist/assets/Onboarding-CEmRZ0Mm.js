import{u as U,r as n,j as e,m as t}from"./vendor-Bm8ggWCn.js";import{u as B,c as W,a as H}from"./index-u9976Wy1.js";import{g as M,a as I,f as P,s as A}from"./news-CtfdD4_O.js";import{C as D,O as G}from"./three-CHCbE9v9.js";import"./ui-OeHMmaS8.js";function b({size:c="medium"}){return e.jsx("div",{className:`relative ${c==="small"?"h-24 w-24":c==="medium"?"h-40 w-40":"h-52 w-52"} mx-auto`,children:e.jsxs(D,{children:[e.jsx("ambientLight",{intensity:.5}),e.jsx("spotLight",{position:[10,10,10],angle:.15,penumbra:1}),e.jsx(H,{size:c}),e.jsx(G,{enableZoom:!1,autoRotate:!0,autoRotateSpeed:.5})]})})}function Z(){const c=U(),{user:o,setUserAfterSignUp:L}=B(),[r,v]=n.useState(1),[d,w]=n.useState([]),[l,x]=n.useState(""),[p,y]=n.useState(null),[f,j]=n.useState(!1),[k,N]=n.useState(!1),[m,h]=n.useState("");n.useEffect(()=>{(async()=>{o&&console.log("User authenticated in onboarding:",o)})()},[o,c]),n.useEffect(()=>{(()=>{if(m&&m.toLowerCase().includes("schema cache")){h("Setting up your preferences. This will take just a moment...");const i=setTimeout(()=>{h("")},2e3);return()=>clearTimeout(i)}})()},[m]);const C=["Technology","Business","Politics","Science","Health","Sports","Entertainment","World News"],S=a=>{d.includes(a)?w(d.filter(i=>i!==a)):w([...d,a])},E=async()=>{N(!0),h("");try{const a=await M();y(a),x("Location detected");try{const i=await I(a.latitude,a.longitude);y(i),x(P(i))}catch(i){console.error("Error getting address:",i),x(`${a.latitude.toFixed(4)}, ${a.longitude.toFixed(4)}`)}}catch(a){console.error("Error getting location:",a),h(a.message||"Failed to get your location"),x("Location permission denied")}finally{N(!1)}},T=async()=>{var a;if(r<3)v(r+1);else{j(!0),h("");try{const i=o?o.id:"temp-"+new Date().getTime();if(o){const g=p?`${p.latitude},${p.longitude}`:l;await W(o.id,{display_name:((a=o.email)==null?void 0:a.split("@")[0])||"User",email:o.email,interests:d,location:g});const{success:z,error:$}=await A(o.id,{categories:d,sources:[],location:g});if(!z)throw $}else L({id:i,email:"demo@example.com"}),await new Promise(g=>setTimeout(g,300));c("/feed")}catch(i){h(i.message||"Failed to save preferences"),console.error("Error saving preferences:",i)}finally{j(!1)}}},F=()=>{r>1&&v(r-1)},u={hidden:{opacity:0,y:20},visible:{opacity:1,y:0,transition:{duration:.5,when:"beforeChildren",staggerChildren:.1}},exit:{opacity:0,y:-20,transition:{duration:.3}}},s={hidden:{opacity:0,y:10},visible:{opacity:1,y:0,transition:{duration:.3}}};return e.jsx("div",{className:"flex items-center justify-center min-h-screen p-4 bg-gradient-to-b from-blue-600 to-blue-800 dark:from-slate-900 dark:to-slate-800",children:e.jsxs(t.div,{className:"w-full max-w-2xl p-8 space-y-8 bg-white rounded-lg shadow-xl dark:bg-gray-900 border border-gray-100 dark:border-gray-800",variants:u,initial:"hidden",animate:"visible",exit:"exit",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(t.h1,{className:"text-3xl font-bold text-blue-600 dark:text-blue-400",variants:s,children:"Set Up Your Profile"}),e.jsxs(t.p,{className:"mt-2 text-gray-700 dark:text-gray-300",variants:s,children:["Step ",r," of 3"]}),e.jsx(t.div,{className:"w-full bg-gray-200 dark:bg-gray-800 h-2 mt-4 rounded-full overflow-hidden",variants:s,children:e.jsx(t.div,{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",initial:{width:`${(r-1)/3*100}%`},animate:{width:`${r/3*100}%`},transition:{duration:.5}})})]}),m&&e.jsx(t.div,{className:`p-3 text-sm rounded-md ${m.includes("Setting up your preferences")?"bg-blue-50 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300":"bg-red-50 dark:bg-red-900/30 text-red-500 dark:text-red-300"}`,variants:s,children:m}),r===1&&e.jsxs(t.div,{className:"space-y-6",variants:u,initial:"hidden",animate:"visible",children:[e.jsx(t.h2,{className:"text-xl font-semibold text-gray-900 dark:text-white",variants:s,children:"Choose Your Interests"}),e.jsx(t.p,{className:"text-gray-700 dark:text-gray-300",variants:s,children:"Select topics you're interested in for personalized news."}),e.jsx(t.div,{className:"grid grid-cols-2 md:grid-cols-4 gap-3",variants:s,children:C.map(a=>e.jsx(t.button,{onClick:()=>S(a),className:`p-3 rounded-md border text-center transition-colors ${d.includes(a)?"bg-blue-600 text-white border-blue-600 hover:bg-blue-700":"bg-white text-gray-800 border-gray-300 hover:border-blue-500 dark:bg-gray-800 dark:text-gray-100 dark:border-gray-700 dark:hover:border-blue-500"}`,variants:s,whileHover:{scale:1.03},whileTap:{scale:.97},children:a},a))}),e.jsx(t.div,{className:"flex justify-center mt-6",variants:s,children:e.jsx(b,{size:"small"})})]}),r===2&&e.jsxs(t.div,{className:"space-y-6",variants:u,initial:"hidden",animate:"visible",children:[e.jsx(t.h2,{className:"text-xl font-semibold text-gray-900 dark:text-white",variants:s,children:"Set Your Location"}),e.jsx(t.p,{className:"text-gray-700 dark:text-gray-300",variants:s,children:"This helps us deliver local news relevant to you."}),e.jsxs(t.div,{className:"space-y-4",variants:s,children:[e.jsx(t.button,{onClick:E,className:"w-full px-4 py-3 text-white bg-blue-600 rounded-md hover:bg-blue-700 transition-colors shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",disabled:k,whileHover:{scale:1.02},whileTap:{scale:.98},children:k?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Getting Location..."]}):e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Use My Current Location"]})}),l&&e.jsxs(t.div,{className:"p-3 bg-green-50 text-green-800 rounded-md dark:bg-green-900/30 dark:text-green-300 flex items-center gap-2",initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},transition:{duration:.3},children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),e.jsx("span",{children:l})]}),e.jsx(t.div,{className:"text-center",variants:s,children:e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Or"})}),e.jsx(t.div,{variants:s,children:e.jsx("input",{type:"text",placeholder:"Enter your city or zip code",value:l==="Location detected"||l==="Location permission denied"||l==="Geolocation not supported"?"":l,onChange:a=>{y(null),x(a.target.value)},className:"block w-full px-4 py-3 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:text-white"})})]}),e.jsx(t.div,{className:"flex justify-center mt-4",variants:s,children:e.jsx(b,{size:"medium"})})]}),r===3&&e.jsxs(t.div,{className:"space-y-6",variants:u,initial:"hidden",animate:"visible",children:[e.jsx(t.h2,{className:"text-xl font-semibold text-gray-900 dark:text-white text-center",variants:s,children:"Ready to Go!"}),e.jsx(t.div,{className:"flex justify-center py-4",variants:s,children:e.jsx(b,{size:"large"})}),e.jsx(t.p,{className:"text-gray-700 dark:text-gray-300 text-center",variants:s,children:"Your profile is set up and we're ready to show you personalized news that matters to you."}),e.jsxs(t.div,{className:"p-6 bg-gray-50 rounded-lg border border-gray-200 dark:bg-gray-700 dark:border-gray-600",variants:s,children:[e.jsx("h3",{className:"font-medium text-gray-900 dark:text-white",children:"Your Preferences"}),e.jsxs("p",{className:"mt-2 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Interests:"})," ",d.join(", ")||"None selected"]}),e.jsxs("p",{className:"mt-1 dark:text-gray-300",children:[e.jsx("span",{className:"font-medium",children:"Location:"})," ",l||"Not specified"]})]})]}),e.jsxs(t.div,{className:"flex justify-between mt-8",variants:s,children:[e.jsx(t.button,{onClick:F,className:`px-4 py-2 border border-gray-300 rounded-md transition-colors dark:border-gray-600 dark:text-gray-300 ${r===1?"opacity-50 cursor-not-allowed":"hover:bg-gray-50 dark:hover:bg-gray-700"}`,disabled:r===1,whileHover:r!==1?{scale:1.02}:{},whileTap:r!==1?{scale:.98}:{},children:"Back"}),e.jsx(t.button,{onClick:T,disabled:f,className:"px-6 py-2 text-white bg-blue-600 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors shadow-md flex items-center",whileHover:{scale:1.02},whileTap:{scale:.98},children:f?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[r===3?"Finish":"Next",r!==3&&e.jsx("svg",{className:"ml-1 w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]})})]})]})})}export{Z as default};
